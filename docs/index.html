<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Hockey Scoreboard Viewer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            color-scheme: dark;
        }
        * { box-sizing: border-box; }
        body {
            margin: 0;
            padding: 16px;
            background: #050814;
            color: #f5f5f5;
        }
        .page {
            max-width: 1100px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        .top-bar {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 8px;
        }
        .arena {
            font-size: 18px;
            font-weight: 600;
        }
        .meta {
            font-size: 14px;
            opacity: 0.8;
            text-align: right;
        }
        .status {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 999px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            border: 1px solid rgba(255,255,255,0.3);
            margin-top: 4px;
        }
        .status-finished {
            background: rgba(0, 200, 83, 0.15);
            border-color: rgba(0, 200, 83, 0.7);
        }
        .status-live {
            background: rgba(244, 67, 54, 0.15);
            border-color: rgba(244, 67, 54, 0.7);
        }
        .status-scheduled {
            background: rgba(255, 193, 7, 0.15);
            border-color: rgba(255, 193, 7, 0.7);
        }

        .scoreboard {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 12px;
            padding: 16px;
            border-radius: 16px;
            background: radial-gradient(circle at top, #273569 0, #050814 55%);
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
        }
        .team { text-align: center; }
        .team-name {
            font-size: 18px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            opacity: 0.9;
        }
        .team-name.red { color: #ff5252; }
        .team-name.white { color: #ffffff; }
        .team-score {
            font-size: 56px;
            font-weight: 700;
        }
        .team-score.red { color: #ff5252; }
        .team-score.white { color: #ffffff; }
        .score-separator {
            font-size: 24px;
            opacity: 0.8;
        }
        .state {
            font-size: 14px;
            opacity: 0.85;
        }
        .state.error { color: #ff8a80; }
        .state.loading { color: #90caf9; }

        .block-title {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.16em;
            opacity: 0.75;
            margin-bottom: 4px;
        }
        .games-card {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 16px;
            padding: 12px 16px;
            box-shadow: 0 4px 18px rgba(0,0,0,0.5);
        }
        .games-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        .games-table thead {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            opacity: 0.7;
        }
        .games-table th,
        .games-table td {
            padding: 6px 4px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.35);
        }
        .games-table tr:last-child td {
            border-bottom: none;
        }
        .games-table th:first-child,
        .games-table td:first-child {
            padding-left: 0;
        }
        .games-table th:last-child,
        .games-table td:last-child {
            padding-right: 0;
        }
        .col-date { white-space: nowrap; }
        .col-arena { min-width: 120px; }
        .col-score { text-align: center; font-weight: 600; }
        .col-team { min-width: 120px; }
        .games-state {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 4px;
        }
        .footer {
            font-size: 11px;
            opacity: 0.6;
            text-align: right;
        }
    </style>
</head>
<body>
<div class="page">
    <!-- Блок текущего табло (пока можно не настраивать ACTIVE_GAME_URL) -->
    <div class="top-bar">
        <div>
            <div class="arena" id="arenaName">Хоккейное табло</div>
            <div class="state loading" id="stateMessage">Табло ещё не настроено.</div>
        </div>
        <div class="meta">
            <div id="gameId"></div>
            <div id="gameDate"></div>
            <div class="status status-scheduled" id="gameStatus">Статус матча</div>
        </div>
    </div>

    <div class="scoreboard">
        <div class="team">
            <div class="team-name red" id="teamRedName">Красные</div>
            <div class="team-score red" id="teamRedScore">0</div>
        </div>
        <div class="score-separator">:</div>
        <div class="team">
            <div class="team-name white" id="teamWhiteName">Белые</div>
            <div class="team-score white" id="teamWhiteScore">0</div>
        </div>
    </div>

    <!-- Блок списка игр по GamesIndex.json -->
    <div class="games-card">
        <div class="block-title">Список игр (по данным GamesIndex.json)</div>
        <div class="games-state state loading" id="gamesState">Загрузка списка игр...</div>
        <div style="overflow-x:auto;">
            <table class="games-table" id="gamesTable" style="display:none;">
                <thead>
                <tr>
                    <th class="col-date">Дата</th>
                    <th class="col-arena">Арена</th>
                    <th class="col-team">Команды</th>
                    <th class="col-score">Счёт</th>
                </tr>
                </thead>
                <tbody id="gamesTableBody"></tbody>
            </table>
        </div>
    </div>

    <div class="footer">
        Табло и список игр обновляются с Google Drive. Список игр — каждые 5 секунд.
    </div>
</div>

<script>
    // 1. URL активной игры (можно пока не трогать, если нет файла active-game.json)
    // пример: "https://drive.google.com/uc?export=download&id=ACTIVE_FILE_ID"
    const ACTIVE_GAME_URL = ""; // оставляем пустым, чтобы не ругалось

    // 2. URL GamesIndex.json (НУЖНО ЗАПОЛНИТЬ)
    // пример: "https://drive.google.com/uc?export=download&id=INDEX_FILE_ID"
    const GAMES_INDEX_URL = "https://drive.google.com/uc?export=download&id=1Vqpfb6hTIgE13X3a4Fbp7QyEe-C1G-Pb";

    const REFRESH_INDEX_MS = 5000;

    const dom = {
        arenaName: document.getElementById("arenaName"),
        gameId: document.getElementById("gameId"),
        gameDate: document.getElementById("gameDate"),
        gameStatus: document.getElementById("gameStatus"),
        teamRedName: document.getElementById("teamRedName"),
        teamWhiteName: document.getElementById("teamWhiteName"),
        teamRedScore: document.getElementById("teamRedScore"),
        teamWhiteScore: document.getElementById("teamWhiteScore"),
        stateMessage: document.getElementById("stateMessage"),

        gamesState: document.getElementById("gamesState"),
        gamesTable: document.getElementById("gamesTable"),
        gamesTableBody: document.getElementById("gamesTableBody")
    };

    function formatDate(iso) {
        if (!iso) return "";
        const d = new Date(iso);
        if (isNaN(d.getTime())) return iso;
        return d.toLocaleString("ru-RU", {
            day: "2-digit",
            month: "2-digit",
            year: "numeric",
            hour: "2-digit",
            minute: "2-digit"
        });
    }

    function computeScoreFromFinal(finalScore) {
        if (!finalScore) return "—";
        const r = typeof finalScore.RED === "number" ? finalScore.RED : 0;
        const w = typeof finalScore.WHITE === "number" ? finalScore.WHITE : 0;
        return r + " : " + w;
    }

    // Заглушка для табло (пока ACTIVE_GAME_URL пустой)
    function initScoreboardStub() {
        dom.stateMessage.textContent = "Табло ещё не настроено. Будет использовать отдельный JSON активной игры.";
        dom.stateMessage.classList.remove("error", "loading");
        dom.stateMessage.classList.add("state");
    }

    // Загрузка GamesIndex.json и отрисовка списка игр
    async function loadGamesIndex() {
        try {
            if (!GAMES_INDEX_URL || GAMES_INDEX_URL.startsWith("ЗДЕСЬ_")) {
                dom.gamesState.classList.add("error");
                dom.gamesState.textContent = "URL GamesIndex.json не настроен.";
                return;
            }

            const response = await fetch(GAMES_INDEX_URL + "&t=" + Date.now(), { cache: "no-store" });
            if (!response.ok) {
                throw new Error("HTTP " + response.status);
            }

            const data = await response.json();
            const games = Array.isArray(data.games) ? data.games.slice() : [];

            // сортируем по дате (новые сверху)
            games.sort((a, b) => {
                const da = new Date(a.date || 0).getTime();
                const db = new Date(b.date || 0).getTime();
                return db - da;
            });

            dom.gamesTableBody.innerHTML = "";

            games.forEach(game => {
                const tr = document.createElement("tr");

                const tdDate = document.createElement("td");
                tdDate.className = "col-date";
                tdDate.textContent = formatDate(game.date);

                const tdArena = document.createElement("td");
                tdArena.className = "col-arena";
                tdArena.textContent = game.arena || "";

                const tdTeams = document.createElement("td");
                tdTeams.className = "col-team";
                // пока просто строкой, позже можем красиво "Красные — Белые"
                tdTeams.textContent = game.gameId || "";

                const tdScore = document.createElement("td");
                tdScore.className = "col-score";
                tdScore.textContent = computeScoreFromFinal(game.finalScore);

                tr.appendChild(tdDate);
                tr.appendChild(tdArena);
                tr.appendChild(tdTeams);
                tr.appendChild(tdScore);

                dom.gamesTableBody.appendChild(tr);
            });

            if (games.length === 0) {
                dom.gamesState.classList.remove("error");
                dom.gamesState.textContent = "В индексе пока нет ни одной игры.";
                dom.gamesTable.style.display = "none";
            } else {
                dom.gamesState.classList.remove("error");
                dom.gamesState.textContent = "Список игр обновлён.";
                dom.gamesTable.style.display = "";
            }
        } catch (e) {
            console.error(e);
            dom.gamesState.classList.add("error");
            dom.gamesState.textContent = "Ошибка загрузки GamesIndex.json: " + e.message;
        }
    }

    // Инициализация
    initScoreboardStub();
    loadGamesIndex();
    setInterval(loadGamesIndex, REFRESH_INDEX_MS);
</script>
</body>
</html>
